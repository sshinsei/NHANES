## ----------------- 协变量: 模型3调整此处---------------------- ##
covariates = c(
"Age", "Race", "EDUcation",
"PIR", "Gender", "BMI", "Smoke", "CHD",
"hyptersion", "Stroke", "Marital","pa","DM"
)
new_dat <- read.csv("../cleanData.csv",row.names = 1)
####研究设计####
options(survey.lonely.psu = "adjust")
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#均数和标准误
svymean(~Age,study_design)
#频数+构成比
freq <- table(new_dat$Age)
prop <- svytable(~Age,study_design)
per <- rbind(prop[1]/sum(prop),prop[2]/sum(prop),prop[2]/sum(prop))
paste0(freq," (",sprintf("%0.2f",per),")")
# -------------- 1. 模型构建 -----------------
options(survey.lonely.psu = "adjust")
##### 四分位数分组 ###########
index_m <- svyquantile(~index,study_design,c(0.25,0.5,0.75))
index_m
index_q <- quantile(new_dat$index, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
new_dat$index_q4 <- cut(new_dat$index,
breaks = c(-Inf, index_q[1], index_q[2], index_q[3], Inf),
labels = c("Q1","Q2","Q3","Q4"),
right = TRUE,
include.lowest = TRUE)
new_dat$index_q4 <- factor(new_dat$index_q4,
levels = c("Q1","Q2","Q3","Q4"))
table(new_dat$index_q4)
#转化参照
# new_dat$index_q4 <- relevel(new_dat$index_q4,"Q4") # Q4为reference
table(new_dat$MI)
#转化结局的编码
new_dat$status <- new_dat$MI
# 重新设计采样
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#### _________四分位数分组进行回归 ####
mod1 <- svyglm(status~index_q4, study_design,family = quasibinomial)
summary(mod1)
results_mod1 <- extract_regression_results(mod1, "model1")
mod2 <- svyglm(status~index_q4+Age+Race+EDUcation+PIR+Gender,
study_design,family = quasibinomial)
summary(mod2)
results_mod2 <- extract_regression_results(mod2, "model2")
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
results_mod3 <- extract_regression_results(mod3, "model3")
# 打印所有结果
cat("\nModel 1 Results:\n")
print(results_mod1)
cat("\nModel 2 Results:\n")
print(results_mod2)
cat("\nModel 3 Results:\n")
print(results_mod3)
source("E:/LZ/25014/r.02.data_process.R")
rm(list=ls())
setwd('E:/LZ/25014')
if(! dir.exists("03_results")) dir.create("03_results")
setwd('./03_results')
library(survey)
library(dplyr)
library(forestplot)
library(rms)
library(ggplot2)
# load functions
source("../functions.R")
# 设置保留小数点后3位
options(digits=3)
## ----------------- 协变量: 模型3调整此处---------------------- ##
covariates = c(
"Age", "Race", "EDUcation",
"PIR", "Gender", "BMI", "Smoke", "CHD",
"hyptersion", "Stroke", "Marital","pa","DM"
)
new_dat <- read.csv("../cleanData.csv",row.names = 1)
####研究设计####
options(survey.lonely.psu = "adjust")
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#均数和标准误
svymean(~Age,study_design)
#频数+构成比
freq <- table(new_dat$Age)
prop <- svytable(~Age,study_design)
per <- rbind(prop[1]/sum(prop),prop[2]/sum(prop),prop[2]/sum(prop))
paste0(freq," (",sprintf("%0.2f",per),")")
# Age
# Race
# Marital
# EDUcation
# PIR
# sleep_time
# Depress
# BMI
# BMI
# WC
# ABMI
# SBP
# DBP
# Smoke
# Drink
# DM
# hypter
# lipids
# -------------- 1. 模型构建 -----------------
options(survey.lonely.psu = "adjust")
##### 四分位数分组 ###########
index_m <- svyquantile(~index,study_design,c(0.25,0.5,0.75))
index_m
index_q <- quantile(new_dat$index, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
new_dat$index_q4 <- cut(new_dat$index,
breaks = c(-Inf, index_q[1], index_q[2], index_q[3], Inf),
labels = c("Q1","Q2","Q3","Q4"),
right = TRUE,
include.lowest = TRUE)
new_dat$index_q4 <- factor(new_dat$index_q4,
levels = c("Q1","Q2","Q3","Q4"))
table(new_dat$index_q4)
# Q1   Q2   Q3   Q4
# 4813 4813 4813 4813
#转化参照
# new_dat$index_q4 <- relevel(new_dat$index_q4,"Q4") # Q4为reference
table(new_dat$MI)
#   0    1
# 18417  835
#转化结局的编码
new_dat$status <- new_dat$MI
# 重新设计采样
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#### _________四分位数分组进行回归 ####
mod1 <- svyglm(status~index_q4, study_design,family = quasibinomial)
summary(mod1)
results_mod1 <- extract_regression_results(mod1, "model1")
mod2 <- svyglm(status~index_q4+Age+Race+EDUcation+PIR+Gender,
study_design,family = quasibinomial)
summary(mod2)
results_mod2 <- extract_regression_results(mod2, "model2")
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
results_mod3 <- extract_regression_results(mod3, "model3")
# 打印所有结果
cat("\nModel 1 Results:\n")
print(results_mod1)
cat("\nModel 2 Results:\n")
print(results_mod2)
cat("\nModel 3 Results:\n")
print(results_mod3)
source("E:/LZ/25014/r.02.data_process.R")
source("E:/LZ/25014/r.02.data_process.R")
rm(list=ls())
setwd('E:/LZ/25014')
if(! dir.exists("03_results")) dir.create("03_results")
setwd('./03_results')
library(survey)
library(dplyr)
library(forestplot)
library(rms)
library(ggplot2)
# load functions
source("../functions.R")
# 设置保留小数点后3位
options(digits=3)
## ----------------- 协变量: 模型3调整此处---------------------- ##
covariates = c(
"Age", "Race", "EDUcation",
"PIR", "Gender", "BMI", "Smoke", "CHD",
"hyptersion", "Stroke", "Marital","pa","DM"
)
new_dat <- read.csv("../cleanData.csv",row.names = 1)
####研究设计####
options(survey.lonely.psu = "adjust")
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#均数和标准误
svymean(~Age,study_design)
#频数+构成比
freq <- table(new_dat$Age)
prop <- svytable(~Age,study_design)
per <- rbind(prop[1]/sum(prop),prop[2]/sum(prop),prop[2]/sum(prop))
paste0(freq," (",sprintf("%0.2f",per),")")
# Age
# Race
# Marital
# EDUcation
# PIR
# sleep_time
# Depress
# BMI
# BMI
# WC
# ABMI
# SBP
# DBP
# Smoke
# Drink
# DM
# hypter
# lipids
# -------------- 1. 模型构建 -----------------
options(survey.lonely.psu = "adjust")
##### 四分位数分组 ###########
index_m <- svyquantile(~index,study_design,c(0.25,0.5,0.75))
index_m
index_q <- quantile(new_dat$index, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
new_dat$index_q4 <- cut(new_dat$index,
breaks = c(-Inf, index_q[1], index_q[2], index_q[3], Inf),
labels = c("Q1","Q2","Q3","Q4"),
right = TRUE,
include.lowest = TRUE)
new_dat$index_q4 <- factor(new_dat$index_q4,
levels = c("Q1","Q2","Q3","Q4"))
table(new_dat$index_q4)
# Q1   Q2   Q3   Q4
# 4813 4813 4813 4813
#转化参照
# new_dat$index_q4 <- relevel(new_dat$index_q4,"Q4") # Q4为reference
table(new_dat$MI)
#   0    1
# 18417  835
#转化结局的编码
new_dat$status <- new_dat$MI
# 重新设计采样
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#### _________四分位数分组进行回归 ####
mod1 <- svyglm(status~index_q4, study_design,family = quasibinomial)
summary(mod1)
results_mod1 <- extract_regression_results(mod1, "model1")
mod2 <- svyglm(status~index_q4+Age+Race+EDUcation+PIR+Gender,
study_design,family = quasibinomial)
summary(mod2)
results_mod2 <- extract_regression_results(mod2, "model2")
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
results_mod3 <- extract_regression_results(mod3, "model3")
# 打印所有结果
cat("\nModel 1 Results:\n")
print(results_mod1)
cat("\nModel 2 Results:\n")
print(results_mod2)
cat("\nModel 3 Results:\n")
print(results_mod3)
## ----------------- 协变量: 模型3调整此处---------------------- ##
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "CHD","hyptersion", "Stroke", "Marital","pa"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处---------------------- ##
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "CHD","hyptersion", "Stroke", "pa"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "hyptersion", "Stroke", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "hyptersion", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "pa","DM"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
source("E:/LZ/25014/r.02.data_process.R")
rm(list=ls())
setwd('E:/LZ/25014')
rm(list=ls())
setwd('E:/LZ/25014')
if(! dir.exists("03_results")) dir.create("03_results")
setwd('./03_results')
library(survey)
library(dplyr)
library(forestplot)
library(rms)
library(ggplot2)
# load functions
source("../functions.R")
# 设置保留小数点后3位
options(digits=3)
new_dat <- read.csv("../cleanData.csv",row.names = 1)
####研究设计####
options(survey.lonely.psu = "adjust")
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#均数和标准误
svymean(~Age,study_design)
#频数+构成比
freq <- table(new_dat$Age)
prop <- svytable(~Age,study_design)
per <- rbind(prop[1]/sum(prop),prop[2]/sum(prop),prop[2]/sum(prop))
paste0(freq," (",sprintf("%0.2f",per),")")
# Age
# Race
# Marital
# EDUcation
# PIR
# sleep_time
# Depress
# BMI
# BMI
# WC
# ABMI
# SBP
# DBP
# Smoke
# Drink
# DM
# hypter
# lipids
# -------------- 1. 模型构建 -----------------
options(survey.lonely.psu = "adjust")
##### 四分位数分组 ###########
index_m <- svyquantile(~index,study_design,c(0.25,0.5,0.75))
index_m
index_q <- quantile(new_dat$index, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
new_dat$index_q4 <- cut(new_dat$index,
breaks = c(-Inf, index_q[1], index_q[2], index_q[3], Inf),
labels = c("Q1","Q2","Q3","Q4"),
right = TRUE,
include.lowest = TRUE)
new_dat$index_q4 <- factor(new_dat$index_q4,
levels = c("Q1","Q2","Q3","Q4"))
table(new_dat$index_q4)
# Q1   Q2   Q3   Q4
# 4813 4813 4813 4813
#转化参照
# new_dat$index_q4 <- relevel(new_dat$index_q4,"Q4") # Q4为reference
table(new_dat$MI)
#   0    1
# 18417  835
#转化结局的编码
new_dat$status <- new_dat$MI
# 重新设计采样
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#### _________四分位数分组进行回归 ####
mod1 <- svyglm(status~index_q4, study_design,family = quasibinomial)
summary(mod1)
results_mod1 <- extract_regression_results(mod1, "model1")
mod2 <- svyglm(status~index_q4+Age+Race+EDUcation+PIR+Gender,
study_design,family = quasibinomial)
summary(mod2)
results_mod2 <- extract_regression_results(mod2, "model2")
## ----------------- 协变量: 模型3调整此处----------------------
covariates = c(
"Age", "Race", "EDUcation", "PIR", "Gender",
"BMI", "Smoke", "pa","DM","Marital"
)
mod3 <- svyglm(as.formula(
paste0("status~index_q4+",paste(covariates, collapse = " + "))),
study_design,family = quasibinomial)
summary(mod3)
source("E:/LZ/25014/r.02.data_process.R")
rm(list=ls())
setwd('E:/LZ/25014')
if(! dir.exists("03_results")) dir.create("03_results")
setwd('./03_results')
library(survey)
library(dplyr)
library(forestplot)
library(rms)
library(ggplot2)
# load functions
source("../functions.R")
# 设置保留小数点后3位
options(digits=3)
new_dat <- read.csv("../cleanData.csv",row.names = 1)
####研究设计####
options(survey.lonely.psu = "adjust")
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#均数和标准误
svymean(~Age,study_design)
#频数+构成比
freq <- table(new_dat$Age)
prop <- svytable(~Age,study_design)
per <- rbind(prop[1]/sum(prop),prop[2]/sum(prop),prop[2]/sum(prop))
paste0(freq," (",sprintf("%0.2f",per),")")
# Age
# Race
# Marital
# EDUcation
# PIR
# sleep_time
# Depress
# BMI
# BMI
# WC
# ABMI
# SBP
# DBP
# Smoke
# Drink
# DM
# hypter
# lipids
# -------------- 1. 模型构建 -----------------
options(survey.lonely.psu = "adjust")
##### 四分位数分组 ###########
index_log_m <- svyquantile(~index_log,study_design,c(0.25,0.5,0.75))
index_log_m
index_log_q <- quantile(new_dat$index_log, probs = c(0.25, 0.5, 0.75), na.rm = TRUE)
new_dat$index_log_q4 <- cut(new_dat$index_log,
breaks = c(-Inf, index_log_q[1], index_log_q[2], index_log_q[3], Inf),
labels = c("Q1","Q2","Q3","Q4"),
right = TRUE,
include.lowest = TRUE)
new_dat$index_log_q4 <- factor(new_dat$index_log_q4,
levels = c("Q1","Q2","Q3","Q4"))
table(new_dat$index_log_q4)
# Q1   Q2   Q3   Q4
# 4813 4813 4813 4813
#转化参照
# new_dat$index_log_q4 <- relevel(new_dat$index_log_q4,"Q4") # Q4为reference
table(new_dat$MI)
#   0    1
# 18417  835
#转化结局的编码
new_dat$status <- new_dat$MI
# 重新设计采样
study_design <- svydesign(data=new_dat,
id=~SDMVPSU,
strata=~SDMVSTRA,
weights=~wt, nest=TRUE)
#### _________四分位数分组进行回归 ####
mod1 <- svyglm(status~index_log_q4, study_design,family = quasibinomial)
summary(mod1)
results_mod1 <- extract_regression_results(mod1, "model1")
mod2 <- svyglm(status~index_log_q4+Age+Race+EDUcation+PIR+Gender,
study_design,family = quasibinomial)
summary(mod2)
results_mod2 <- extract_regression_results(mod2, "model2")
